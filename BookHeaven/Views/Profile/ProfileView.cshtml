@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="~/css/userInfo.css">
</head>
<body>
    <div class="container2">
        <h1>User Profile</h1>
        <button class="edit-button" onclick="editProfile()">Edit</button>
        <div class="profile-info">
            <h2>User Information</h2>

            <!-- Email input field -->
            <div id="email">
                <p>
                    <strong>Email:</strong>
                    <span id="emailSpan">user@example.com</span>
                    <input type="email" class="input-field" id="emailInput" style="display: none;">
                </p>
            </div>

            <!-- First name input field -->
            <div id="firstName">
                <p>
                    <strong>First Name:</strong>
                    <span id="firstNameSpan">John</span>
                    <input type="text" class="input-field" id="firstNameInput" style="display: none;">
                </p>
            </div>

            <!-- Last name input field -->
            <div id="lastName">
                <p>
                    <strong>Last Name:</strong>
                    <span id="lastNameSpan">Doe</span>
                    <input type="text" class="input-field" id="lastNameInput" style="display: none;">
                </p>
            </div>

            <!-- Address input fields -->
            <div id="address">
                <p>
                    <strong>Address:</strong>
                    <span id="addressSpan">123, Main St, City, Country</span>
                    <button class="delete-button" onclick="deleteAddress()">🗑️</button>

                    <input type="text" placeholder="Country" class="input-field" id="countryInput" style="display: none;">
                    <input type="text" placeholder="City" class="input-field" id="cityInput" style="display: none;">
                    <input type="text" placeholder="Street" class="input-field" id="streetInput" style="display: none;">
                    <input type="text" placeholder="Apartment Number" class="input-field small-input" id="apartmentInput" style="display: none;">
                </p>
            </div>

            <!-- Credit card input fields -->
            <div id="creditCard">
                <p><strong>Credit Card:</strong> <span id="creditCardSpan">**** **** **** 1234 | 04/25 | 745</span> <button class="delete-button" onclick="deleteCreditCard()">🗑️</button></p>

                <input type="text" placeholder="Card Number" class="input-field" id="cardNumberInput" style="display: none;">
                <input type="text" placeholder="MM/YY" class="input-field small-input" id="expirationInput" style="display: none;">
                <input type="text" placeholder="CCV" class="input-field small-input" id="ccvInput" style="display: none;">
            </div>


        </div>
        <div class="purchase-history">
            <h2>Purchase History</h2>
            <table>
                <thead>
                    <tr>
                        <th>Book Name</th>
                        <th>Quantity</th>
                        <th>Price Paid</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>The Great Gatsby</td>
                        <td>2</td>
                        <td>$20.00</td>
                    </tr>
                    <tr>
                        <td>To Kill a Mockingbird</td>
                        <td>1</td>
                        <td>$15.00</td>
                    </tr>
                    <!-- Add more rows for additional purchases -->
                </tbody>
            </table>
        </div>
    </div>
    <script>
        function editProfile() {
            // Toggle visibility of email input field
            var emailSpan = document.getElementById('emailSpan');
            var emailInput = document.getElementById('emailInput');
            emailInput.value = emailSpan.textContent;
            emailSpan.textContent = '';
            emailInput.style.display = (emailInput.style.display === 'none') ? 'block' : 'none';

            // Toggle visibility of first name input field
            var firstNameSpan = document.getElementById('firstNameSpan');
            var firstNameInput = document.getElementById('firstNameInput');
            firstNameInput.value = firstNameSpan.textContent;
            firstNameSpan.textContent = '';
            firstNameInput.style.display = (firstNameInput.style.display === 'none') ? 'block' : 'none';

            // Toggle visibility of last name input field
            var lastNameSpan = document.getElementById('lastNameSpan');
            var lastNameInput = document.getElementById('lastNameInput');
            lastNameInput.value = lastNameSpan.textContent;
            lastNameSpan.textContent = '';
            lastNameInput.style.display = (lastNameInput.style.display === 'none') ? 'block' : 'none';

            // Toggle visibility of address input fields
            var addressSpan = document.getElementById('addressSpan');
            var addressParts = addressSpan.textContent.split(', ');
            addressSpan.textContent = '';

            // Assign values to respective input fields
            document.getElementById('countryInput').value = addressParts.pop(); // Last part is country
            document.getElementById('cityInput').value = addressParts.pop(); // Next part is city
            document.getElementById('streetInput').value = addressParts.pop(); // Next part is street
            document.getElementById('apartmentInput').value = addressParts.pop(); // First part is apartment number

            var addressInputs = document.getElementById('address').querySelectorAll('.input-field');
            addressInputs.forEach(input => {
                input.style.display = (input.style.display === 'none') ? 'block' : 'none';
            });


            // Toggle visibility of credit card input fields
            var creditCardSpan = document.getElementById('creditCardSpan');
            var creditCardParts = creditCardSpan.textContent.split(' | ');
            creditCardSpan.textContent = '';

            // Assign values to respective input fields
            document.getElementById('ccvInput').value = creditCardParts.pop(); // Last part is country
            document.getElementById('expirationInput').value = creditCardParts.pop(); // Next part is city
            document.getElementById('cardNumberInput').value = creditCardParts.pop(); // Next part is street

            var creditCardInputs = document.getElementById('creditCard').querySelectorAll('.input-field');
            creditCardInputs.forEach(input => {
                input.style.display = (input.style.display === 'none') ? 'block' : 'none';
            });

            // Toggle visibility of delete buttons
            var deleteButtons = document.querySelectorAll('.delete-button');
            deleteButtons.forEach(button => {
                button.style.display = (button.style.display === 'none') ? 'block' : 'none';
            });

            // Change edit button to save button
            var editButton = document.querySelector('.edit-button');
            editButton.innerHTML = (editButton.innerHTML === 'Edit') ? 'Save' : 'Edit';
            editButton.setAttribute('onclick', (editButton.getAttribute('onclick') === 'editProfile()') ? 'saveProfile()' : 'editProfile()');
        }

        function saveProfile() {
            // Update email with input value
            var emailSpan = document.getElementById('emailSpan');
            var emailInput = document.getElementById('emailInput');
            emailSpan.textContent = emailInput.value;

            // Update first name with input value
            var firstNameSpan = document.getElementById('firstNameSpan');
            var firstNameInput = document.getElementById('firstNameInput');
            firstNameSpan.textContent = firstNameInput.value;

            // Update last name with input value
            var lastNameSpan = document.getElementById('lastNameSpan');
            var lastNameInput = document.getElementById('lastNameInput');
            lastNameSpan.textContent = lastNameInput.value;

            emailInput.style.display = 'none';
            firstNameInput.style.display = 'none';
            lastNameInput.style.display = 'none';

            // Update address with input values
            var addressSpan = document.getElementById('addressSpan');
            var countryInput = document.getElementById('countryInput').value;
            var cityInput = document.getElementById('cityInput').value;
            var streetInput = document.getElementById('streetInput').value;
            var apartmentInput = document.getElementById('apartmentInput').value;
            addressSpan.textContent = streetInput + ', ' + cityInput + ', ' + countryInput + ', ' + apartmentInput;
            var addressInputs = document.getElementById('address').querySelectorAll('.input-field');
            addressInputs.forEach(input => {
                input.style.display = 'none';
            });

            // Update credit card with input values
            var creditCardSpan = document.getElementById('creditCardSpan');
            var cardNumberInput = document.getElementById('cardNumberInput').value;
            var expirationInput = document.getElementById('expirationInput').value;
            var ccvInput = document.getElementById('ccvInput').value;
            creditCardSpan.textContent = cardNumberInput + ' | ' + expirationInput + ' | ' + ccvInput;
            var creditCardInputs = document.getElementById('creditCard').querySelectorAll('.input-field');
            creditCardInputs.forEach(input => {
                input.style.display = 'none';
            });

            // Show delete buttons
            var deleteButtons = document.querySelectorAll('.delete-button');
            deleteButtons.forEach(button => {
                button.style.display = 'inline-block';
            });

            // Change save button back to edit button
            var editButton = document.querySelector('.edit-button');
            editButton.innerHTML = 'Edit';
            editButton.setAttribute('onclick', 'editProfile()');
        }


        function deleteAddress() {
            // AJAX request to delete credit card information
            fetch('DeleteAddress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({}),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    console.log('Address deleted');
                    document.getElementById('addressSpan').innerHTML = '<span></span>';
                    document.querySelectorAll('.delete-button').forEach(button => button.classList.remove('hide'));
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        }

        function deleteCreditCard() {
            // AJAX request to delete credit card information
            fetch('DeleteCreditCard', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({}),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    console.log('Credit Card deleted');
                    document.getElementById('creditCardSpan').innerHTML = '<span></span>';
                    document.querySelectorAll('.delete-button').forEach(button => button.classList.remove('hide'));
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        }
    </script>
</body>
</html>


